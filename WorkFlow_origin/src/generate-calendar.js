import { readFileSync, writeFileSync, existsSync, readdirSync, mkdirSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';
import { GoogleGenerativeAI } from '@google/generative-ai';
import dotenv from 'dotenv';

dotenv.config();

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

/**
 * CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ¼ã‚¹
 */
function parseCSV(content) {
  const lines = content.trim().split('\n');
  if (lines.length < 2) return null;

  const headers = lines[0].split(',');
  const values = lines[1].split(',');

  const result = {};
  headers.forEach((header, i) => {
    result[header.trim()] = values[i] ? values[i].trim().replace(/^"|"$/g, '') : '';
  });

  return result;
}

/**
 * characterãƒ•ã‚©ãƒ«ãƒ€ã®ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼‰ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—
 */
function listCharacters() {
  const characterDir = join(__dirname, '..', 'character');
  if (!existsSync(characterDir)) return [];

  return readdirSync(characterDir, { withFileTypes: true })
    .filter(dirent => dirent.isDirectory())
    .map(dirent => dirent.name);
}

/**
 * imageruleãƒ•ã‚©ãƒ«ãƒ€ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—
 */
function listImageRules() {
  const imageruleDir = join(__dirname, '..', 'imagerule');
  if (!existsSync(imageruleDir)) return [];

  return readdirSync(imageruleDir)
    .filter(file => file.endsWith('.csv'))
    .map(file => file.replace('.csv', ''));
}

/**
 * ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’èª­ã¿è¾¼ã¿
 */
function loadCharacter(characterName) {
  // ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€å†…ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã™
  const characterPath = join(__dirname, '..', 'character', characterName, `${characterName}.csv`);
  if (!existsSync(characterPath)) {
    throw new Error(`ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${characterName}`);
  }

  const content = readFileSync(characterPath, 'utf-8');
  return parseCSV(content);
}

/**
 * ç”»åƒä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
 */
function loadImageRule(ruleName) {
  const rulePath = join(__dirname, '..', 'imagerule', `${ruleName}.csv`);
  if (!existsSync(rulePath)) {
    throw new Error(`ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${ruleName}`);
  }

  const content = readFileSync(rulePath, 'utf-8');
  return parseCSV(content);
}

/**
 * å…¨ã¦ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’èª­ã¿è¾¼ã¿
 */
function loadAllCharacters() {
  const characterDir = join(__dirname, '..', 'character');
  if (!existsSync(characterDir)) return [];

  // ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—
  const folders = readdirSync(characterDir, { withFileTypes: true })
    .filter(dirent => dirent.isDirectory())
    .map(dirent => dirent.name);

  const characters = [];

  for (const characterName of folders) {
    try {
      const character = loadCharacter(characterName);
      characters.push(character);
    } catch (error) {
      console.warn(`âš ï¸  ${characterName}ã®èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—:`, error.message);
    }
  }

  return characters;
}

/**
 * å…¨ã¦ã®ç”»åƒä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
 */
function loadAllImageRules() {
  const imageruleDir = join(__dirname, '..', 'imagerule');
  if (!existsSync(imageruleDir)) return [];

  const files = readdirSync(imageruleDir).filter(file => file.endsWith('.csv'));
  const rules = [];

  for (const file of files) {
    const ruleName = file.replace('.csv', '');
    try {
      const rule = loadImageRule(ruleName);
      rules.push(rule);
    } catch (error) {
      console.warn(`âš ï¸  ${ruleName}ã®èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—:`, error.message);
    }
  }

  return rules;
}

/**
 * æ—¢å­˜ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’èª­ã¿è¾¼ã‚€
 */
function loadExistingCalendars() {
  const calendarDir = join(__dirname, '..', 'calendar');
  if (!existsSync(calendarDir)) {
    mkdirSync(calendarDir, { recursive: true });
    console.log('ğŸ“ calendarãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã—ãŸ');
    return [];
  }

  const files = readdirSync(calendarDir)
    .filter(file => file.startsWith('calendar_') && file.endsWith('.csv'))
    .sort()
    .reverse(); // æœ€æ–°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ˆã«

  const existingPosts = [];

  for (const file of files) {
    try {
      const filePath = join(calendarDir, file);
      const content = readFileSync(filePath, 'utf-8');
      const lines = content.split('\n').filter(line => line.trim());

      lines.forEach((line, index) => {
        const fields = parseCSVLine(line);
        if (fields.length >= 13) {
          existingPosts.push({
            file: file,
            day: index + 1,
            coverImage: fields[0],
            postText: fields[12]
          });
        }
      });
    } catch (error) {
      console.warn(`âš ï¸  ${file}ã®èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—:`, error.message);
    }
  }

  return existingPosts;
}

/**
 * AIã§æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆCSVï¼‰ã‚’ç”Ÿæˆ
 */
async function generateCalendar() {
  try {
    console.log('ğŸ“… InstagramæŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆä¸­...\n');

    // APIã‚­ãƒ¼ã®ç¢ºèª
    if (!process.env.GEMINI_API_KEY) {
      throw new Error('GEMINI_API_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }

    // æŠ•ç¨¿æ•°ã®è¨­å®šï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯30æ—¥ï¼‰
    const calendarDays = parseInt(process.env.CALENDAR_DAYS) || 30;
    console.log(`ğŸ“† ç”Ÿæˆã™ã‚‹æŠ•ç¨¿æ•°: ${calendarDays}æ—¥åˆ†\n`);

    // æ—¢å­˜ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’èª­ã¿è¾¼ã‚€
    const existingPosts = loadExistingCalendars();
    console.log(`ğŸ“š æ—¢å­˜ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰${existingPosts.length}ä»¶ã®æŠ•ç¨¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\n`);

    // äº‹æ¥­æƒ…å ±ã®èª­ã¿è¾¼ã¿
    const businessSummaryPath = join(__dirname, '..', 'output', 'business-summary.txt');
    if (!existsSync(businessSummaryPath)) {
      throw new Error('business-summary.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«analyze-homepage.jsã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
    }
    const businessSummary = readFileSync(businessSummaryPath, 'utf-8');

    // å…¨ã¦ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã¨ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿
    const characters = loadAllCharacters();
    const imageRules = loadAllImageRules();

    console.log('âœ… äº‹æ¥­æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
    console.log(`âœ… ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${characters.length}äººï¼‰`);
    console.log(`âœ… ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${imageRules.length}å€‹ï¼‰\n`);

    if (characters.length === 0) {
      throw new Error('ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚characterãƒ•ã‚©ãƒ«ãƒ€ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚');
    }

    if (imageRules.length === 0) {
      throw new Error('ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚imageruleãƒ•ã‚©ãƒ«ãƒ€ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚');
    }

    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
    console.log('ğŸ‘¥ èª­ã¿è¾¼ã‚“ã ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:');
    characters.forEach(char => {
      console.log(`   - ${char.name}`);
    });

    console.log('\nğŸ¨ èª­ã¿è¾¼ã‚“ã ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«:');
    imageRules.forEach(rule => {
      console.log(`   - ${rule.setting_name || rule.name}`);
    });
    console.log();

    // Gemini APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
    const model = genAI.getGenerativeModel({ model: 'gemini-2.5-flash' });

    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    const charactersSection = characters.map((char, idx) => `
## ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼${idx + 1}: ${char.name}
- å¤–è¦‹: ${char.appearance}
- é«ª: ${char.hair}
- ç›®: ${char.eyes}
- é¡”: ${char.face}
- ä½“å‹: ${char.body}
- æœè£…: ${char.clothing}
- æ€§æ ¼: ${char.personality}
- è¿½åŠ æƒ…å ±: ${char.additional}
`).join('\n');

    // ç”»åƒãƒ«ãƒ¼ãƒ«æƒ…å ±ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    const imageRulesSection = imageRules.map((rule, idx) => `
## ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«${idx + 1}: ${rule.setting_name || rule.name}
- å ´æ‰€ãƒ»ç’°å¢ƒ: ${rule.location_environment || rule.location}
- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»äººç‰©: ${rule.characters_people || rule.characters}
- æ™‚é–“å¸¯ãƒ»ç…§æ˜: ${rule.time_lighting || rule.lighting}
- é›°å›²æ°—ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«: ${rule.atmosphere_style || rule.style}
- è¿½åŠ ã®è©³ç´°è¨­å®š: ${rule.additional_details || rule.additional}
`).join('\n');

    // æ—¢å­˜æŠ•ç¨¿æƒ…å ±ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    let existingPostsSection = '';
    if (existingPosts.length > 0) {
      const recentPosts = existingPosts.slice(0, 50); // æœ€æ–°50ä»¶ã‚’å‚ç…§

      // æ—¢å­˜æŠ•ç¨¿ã®ãƒ†ãƒ¼ãƒã‚’åˆ†æ
      const existingThemes = recentPosts.map(post => {
        const text = post.postText.toLowerCase();
        return {
          hasMinecraft: text.includes('ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆ') || text.includes('minecraft'),
          hasAI: text.includes('ai') || text.includes('äººå·¥çŸ¥èƒ½'),
          hasEntrepreneur: text.includes('èµ·æ¥­') || text.includes('ãƒ“ã‚¸ãƒã‚¹'),
          hasParent: text.includes('ä¿è­·è€…') || text.includes('ãŠæ¯æ§˜') || text.includes('è¦ªå¾¡'),
          hasStudent: text.includes('ç”Ÿå¾’') || text.includes('å­ã©ã‚‚'),
          hasInstructor: text.includes('è¬›å¸«') || text.includes('å…ˆç”Ÿ') || text.includes('ãƒ¡ãƒ³ã‚¿ãƒ¼'),
          text: post.postText.substring(0, 200)
        };
      });

      existingPostsSection = `
# æ—¢å­˜ã®æŠ•ç¨¿å±¥æ­´ï¼ˆ${recentPosts.length}ä»¶ï¼‰- é‡è¤‡å›é¿ã®ãŸã‚ã®é‡è¦ãªå‚è€ƒæƒ…å ±

## ğŸ“Š æ—¢å­˜æŠ•ç¨¿ã®çµ±è¨ˆ
- ç·æŠ•ç¨¿æ•°: ${existingPosts.length}ä»¶
- å‚ç…§ã™ã‚‹æœ€æ–°æŠ•ç¨¿: ${recentPosts.length}ä»¶
- æœ€ã‚‚å¤ã„å‚ç…§æŠ•ç¨¿: ${recentPosts[recentPosts.length - 1]?.file || 'ä¸æ˜'}
- æœ€ã‚‚æ–°ã—ã„å‚ç…§æŠ•ç¨¿: ${recentPosts[0]?.file || 'ä¸æ˜'}

## ğŸ¯ æ—¢å­˜æŠ•ç¨¿ã®ãƒ†ãƒ¼ãƒå‚¾å‘
- ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆé–¢é€£: ${existingThemes.filter(t => t.hasMinecraft).length}ä»¶
- AIé–¢é€£: ${existingThemes.filter(t => t.hasAI).length}ä»¶
- èµ·æ¥­ãƒ»ãƒ“ã‚¸ãƒã‚¹é–¢é€£: ${existingThemes.filter(t => t.hasEntrepreneur).length}ä»¶
- ä¿è­·è€…å‘ã‘: ${existingThemes.filter(t => t.hasParent).length}ä»¶
- ç”Ÿå¾’ã®æˆé•·ãƒ»äº‹ä¾‹: ${existingThemes.filter(t => t.hasStudent).length}ä»¶
- è¬›å¸«ç´¹ä»‹: ${existingThemes.filter(t => t.hasInstructor).length}ä»¶

## ğŸ“ æœ€è¿‘ã®æŠ•ç¨¿ã‚µãƒ³ãƒ—ãƒ«ï¼ˆæœ€æ–°10ä»¶ï¼‰
${recentPosts.slice(0, 10).map((post, idx) => `
### æ—¢å­˜æŠ•ç¨¿${idx + 1}ï¼ˆ${post.file}ï¼‰
- è¡¨ç´™ç”»åƒã®æ¦‚è¦: ${post.coverImage.substring(0, 120)}...
- æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆ: ${post.postText.substring(0, 180)}...
`).join('\n')}

## âš ï¸ é‡è¦ãªåˆ¶ç´„ - æ–°è¦æ€§ã®ç¢ºä¿
**å¿…ãšä»¥ä¸‹ã‚’å®ˆã£ã¦ãã ã•ã„:**

1. **å®Œå…¨ã«æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚’é¸ã¶**
   - ä¸Šè¨˜ã®æ—¢å­˜æŠ•ç¨¿ã¨åŒã˜ãƒ†ãƒ¼ãƒãƒ»åˆ‡ã‚Šå£ã¯é¿ã‘ã‚‹
   - æ—¢ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹å…·ä½“ä¾‹ã‚„äº‹ä¾‹ã¯ä½¿ç”¨ã—ãªã„
   - åŒã˜ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®çµ„ã¿åˆã‚ã›ãŒé€£ç¶šã—ãªã„ã‚ˆã†ã«ã™ã‚‹

2. **æ–°ã—ã„è¦–ç‚¹ã‚’æä¾›**
   - ã€Œã€‡ã€‡ã ã£ãŸå­ãŒä»Šã§ã¯ã€œã€ã®ã‚ˆã†ãªåŒã˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®é€£ç¶šä½¿ç”¨ã‚’é¿ã‘ã‚‹
   - ç•°ãªã‚‹æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ï¼ˆä¿è­·è€…å…±æ„Ÿå‹ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å‹ãªã©ï¼‰ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãé…åˆ†
   - å­£ç¯€æ„Ÿã€æ™‚äº‹æ€§ã€æ–°ã—ã„ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å–ã‚Šå…¥ã‚Œã‚‹

3. **ãƒ†ãƒ¼ãƒã®å¤šæ§˜æ€§ã‚’ç¢ºä¿**
   - ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã ã‘ã§ãªãã€AIã€èµ·æ¥­ã€ãƒ¡ãƒ³ã‚¿ãƒ¼ã€å­¦ç¿’æ–¹æ³•ãªã©å¤šæ§˜ãªãƒ†ãƒ¼ãƒã‚’æ‰±ã†
   - ä¿è­·è€…å‘ã‘ã¨ç”Ÿå¾’å‘ã‘ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹
   - Q&Aå‹ã€æ—¥å¸¸é¢¨æ™¯å‹ãªã©ã€æ§˜ã€…ãªæŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã‚’æ´»ç”¨

4. **å…·ä½“æ€§ã®å¤‰åŒ–**
   - ã€Œå°6ç”·å­ã€ã€Œä¸­1å¥³å­ã€ãªã©ã€æ—¢å­˜æŠ•ç¨¿ã§ä½¿ã‚ã‚ŒãŸå…·ä½“ä¾‹ã¨ç•°ãªã‚‹ä¾‹ã‚’ä½¿ã†
   - æ–°ã—ã„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã€æ–°ã—ã„æ•°å­—ã€æ–°ã—ã„å®Ÿç¸¾ã‚’å‰µé€ çš„ã«æç¤º

**ä»Šå›ç”Ÿæˆã™ã‚‹æŠ•ç¨¿ã¯ã€ä¸Šè¨˜ã®æ—¢å­˜æŠ•ç¨¿ã¨ã¯æ˜ç¢ºã«ç•°ãªã‚‹ã€å…¨ãæ–°ã—ã„å†…å®¹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚**
`;
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    const prompt = `
ã‚ãªãŸã¯Instagramãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚ä»¥ä¸‹ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€${calendarDays}æ—¥åˆ†ã®InstagramæŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆã‚«ãƒ«ãƒ¼ã‚»ãƒ«å½¢å¼ï¼‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

# äº‹æ¥­æƒ…å ±
${businessSummary}

${existingPostsSection}

# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆç™»å ´äººç‰©ã®ä¸€è²«æ€§ï¼‰
ä»¥ä¸‹ã®${characters.length}äººã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚æŠ•ç¨¿å†…å®¹ã«å¿œã˜ã¦é©åˆ‡ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸ã‚“ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚è¤‡æ•°äººã‚’1ã¤ã®æŠ•ç¨¿ã«ç™»å ´ã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
${charactersSection}

# ç”»åƒä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«
ä»¥ä¸‹ã®${imageRules.length}å€‹ã®ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚æŠ•ç¨¿å†…å®¹ã«å¿œã˜ã¦é©åˆ‡ãªãƒ«ãƒ¼ãƒ«ã‚’é¸ã‚“ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
${imageRulesSection}

# ã‚«ãƒ«ãƒ¼ã‚»ãƒ«æŠ•ç¨¿ã®æ§‹æˆ
å„æ—¥ã®æŠ•ç¨¿ã¯4æšã®ç”»åƒã§æ§‹æˆã•ã‚Œã¾ã™ï¼š
1. è¡¨ç´™ï¼ˆãƒ•ãƒƒã‚¯ã§æ³¨ç›®ã‚’é›†ã‚ã‚‹ï¼‰
2. å†…å®¹1ï¼ˆå•é¡Œæèµ·ã¾ãŸã¯å…±æ„Ÿï¼‰
3. å†…å®¹2ï¼ˆè§£æ±ºç­–ã¾ãŸã¯ä¾¡å€¤æç¤ºï¼‰
4. å†…å®¹3ï¼ˆã¾ã¨ã‚ãƒ»CTAï¼‰

# CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆ13åˆ—ï¼‰
Aåˆ—: è¡¨ç´™ç”»åƒèª¬æ˜ï¼ˆæ—¥æœ¬èªï¼‰
Båˆ—: è¡¨ç´™ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢1
Cåˆ—: è¡¨ç´™ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢2
Dåˆ—: å†…å®¹1ç”»åƒèª¬æ˜ï¼ˆæ—¥æœ¬èªï¼‰
Eåˆ—: å†…å®¹1ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢1
Fåˆ—: å†…å®¹1ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢2
Gåˆ—: å†…å®¹2ç”»åƒèª¬æ˜ï¼ˆæ—¥æœ¬èªï¼‰
Håˆ—: å†…å®¹2ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢1
Iåˆ—: å†…å®¹2ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢2
Jåˆ—: å†…å®¹3ç”»åƒèª¬æ˜ï¼ˆæ—¥æœ¬èªï¼‰
Kåˆ—: å†…å®¹3ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢1
Låˆ—: å†…å®¹3ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢2
Måˆ—: æŠ•ç¨¿ã®ãƒ†ã‚­ã‚¹ãƒˆ+ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°

## ç”»åƒèª¬æ˜ï¼ˆA,D,G,Jåˆ—ï¼‰ã®ä½œæˆãƒ«ãƒ¼ãƒ«
- **å¿…ãšæ—¥æœ¬èªã§è¨˜è¿°**
- **é‡è¦: æ¶ç©ºã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ä½œæˆã—ãªã„ã§ãã ã•ã„ã€‚å¿…ãšä¸Šè¨˜ã®ã€Œã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã€ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„**
- ä¸Šè¨˜ã®ã€Œã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã€ã‹ã‚‰é©åˆ‡ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸ã‚“ã§ç™»å ´ã•ã›ã‚‹ï¼ˆè¤‡æ•°äººã‚‚å¯ï¼‰
- **ä¸­å¹´ç”·æ€§ãŒå¿…è¦ãªå ´åˆã¯ã€å¿…ãšã€Œå¡¾é ­é«˜å´ç¿”å¤ªã€ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„**
- ä¸Šè¨˜ã®ã€Œç”»åƒä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã€ã‹ã‚‰æŠ•ç¨¿å†…å®¹ã«é©ã—ãŸãƒ«ãƒ¼ãƒ«ã‚’é¸ã‚“ã§é©ç”¨
- äººç‰©ãŒç™»å ´ã™ã‚‹å ´åˆã¯ã€é¸ã‚“ã ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å¤–è¦‹ãƒ»æœè£…ãƒ»æ€§æ ¼ã‚’æ­£ç¢ºã«æå†™
- å ´æ‰€ãƒ»ç…§æ˜ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«ã¯é¸ã‚“ã ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã«å¾“ã†
- å…·ä½“çš„ã§è©³ç´°ãªæå†™ï¼ˆAIãŒç”»åƒç”Ÿæˆã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã®è©³ç´°ã•ï¼‰
- å„ç”»åƒã¯ç•°ãªã‚‹æ§‹å›³ãƒ»ã‚¢ãƒ³ã‚°ãƒ«ã«ã™ã‚‹
- ${calendarDays}æ—¥åˆ†ã®æŠ•ç¨¿å…¨ä½“ã§ã€å…¨ã¦ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨å…¨ã¦ã®ãƒ«ãƒ¼ãƒ«ãŒãƒãƒ©ãƒ³ã‚¹è‰¯ãç™»å ´ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹

## ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢1ï¼ˆB,E,H,Kåˆ—ï¼‰ã®ãƒ«ãƒ¼ãƒ«
- 1è¡Œã‚ãŸã‚Šæœ€å¤§8æ–‡å­—
- æœ€å¤§2è¡Œã¾ã§
- å˜èªã®é€”ä¸­ã§ã¯æ”¹è¡Œã—ãªã„
- æ”¹è¡Œã¯å˜èªã®åŒºåˆ‡ã‚Šç›®ã§è¡Œã†
- **æ”¹è¡Œã¯ã€Œ\\nã€ã§è¡¨ç¾ã™ã‚‹**ï¼ˆä¾‹: "AIã¨\\nèµ·æ¥­"ï¼‰
- ã‚­ãƒ£ãƒƒãƒãƒ¼ã§çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚º

## ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢2ï¼ˆC,F,I,Låˆ—ï¼‰ã®ãƒ«ãƒ¼ãƒ«
- 1è¡Œã‚ãŸã‚Šæœ€å¤§12æ–‡å­—
- æœ€å¤§4è¡Œã¾ã§
- å˜èªã®é€”ä¸­ã§ã¯æ”¹è¡Œã—ãªã„
- æ”¹è¡Œã¯å˜èªã®åŒºåˆ‡ã‚Šç›®ã§è¡Œã†
- **æ”¹è¡Œã¯ã€Œ\\nã€ã§è¡¨ç¾ã™ã‚‹**ï¼ˆä¾‹: "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°\\nã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¡¾\\nif(å¡¾)ã¸\\nã‚ˆã†ã“ãï¼"ï¼‰
- ã‚ˆã‚Šè©³ç´°ãªèª¬æ˜

## æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆ+ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆMåˆ—ï¼‰ã®ãƒ«ãƒ¼ãƒ«

### æŠ•ç¨¿æ–‡ã®æ§‹é€ ï¼ˆ3æ®µæ§‹æˆï¼‰
1. **ãƒ•ãƒƒã‚¯ï¼ˆ1ã€œ2æ–‡ï¼‰**: èª­è€…ã®æ³¨æ„ã‚’å¼•ãã€å…±æ„Ÿã‚„é©šãã®è¦ç´ 
   - ä¾‹: ã€Œå­¦æ ¡ã¯è¡Œã‘ãªã„ã‘ã©ã€ã“ã“ãªã‚‰æ¥½ã—ãé€šã£ã¦ã¾ã™ã€
   - ä¾‹: ã€Œã‚²ãƒ¼ãƒ ã°ã‹ã‚Šã ã£ãŸå­ãŒã€ä»Šã§ã¯è‡ªåˆ†ã§ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã„ã¾ã™ã€

2. **ä¾¡å€¤æç¤ºï¼ˆ3ã€œ4æ–‡ï¼‰**: å…·ä½“çš„ãªãƒ¡ãƒªãƒƒãƒˆã€è§£æ±ºç­–ã€å®Ÿç¸¾
   - âœ…ãƒãƒ¼ã‚¯ã‚„æ•°å­—ã‚’ä½¿ã£ã¦èª­ã¿ã‚„ã™ã
   - å…·ä½“çš„ãªã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚„äº‹ä¾‹ã‚’å«ã‚ã‚‹
   - ä¿¡é ¼æ„Ÿã‚’ä¸ãˆã‚‹æƒ…å ±ï¼ˆå®Ÿç¸¾ã€ã‚µãƒãƒ¼ãƒˆä½“åˆ¶ãªã©ï¼‰

3. **CTAï¼ˆ1ã€œ2æ–‡ï¼‰**: æ˜ç¢ºãªè¡Œå‹•å–šèµ·
   - ã€Œç„¡æ–™ä½“é¨“å®Ÿæ–½ä¸­ã€ã€Œã¾ãšã¯ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ã€
   - ã€Œãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã¾ãŸã¯DMã¸ã€

### æŠ•ç¨¿æ–‡ã®è©³ç´°ãƒ«ãƒ¼ãƒ«
- æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆã¯æ”¹è¡Œã‚’ä½¿ã‚ãšã€å¥èª­ç‚¹ï¼ˆã€ã€‚ï¼‰ã§åŒºåˆ‡ã‚‹
- 200ã€œ250æ–‡å­—ç¨‹åº¦ã®é­…åŠ›çš„ãªæ–‡ç« 
- èª­è€…ç›®ç·šã§æ›¸ãï¼ˆä¿è­·è€…ã®æ‚©ã¿ã€ç”Ÿå¾’ã®æ°—æŒã¡ã«å¯„ã‚Šæ·»ã†ï¼‰
- å…·ä½“æ€§ã‚’é‡è¦–ï¼ˆã€Œå¤šãã®ç”Ÿå¾’ã€ã‚ˆã‚Šã€Œå°6ç”·å­ã€ã®ã‚ˆã†ã«ï¼‰
- æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆã®å¾Œã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥ã‚Œã¦ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ç¶šã‘ã‚‹

### ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æˆ¦ç•¥
**å¿…é ˆãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆæ¯å›å«ã‚ã‚‹ï¼‰**: #ifå¡¾ #ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° #AIå­¦ç¿’

**ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆæŠ•ç¨¿å†…å®¹ã«å¿œã˜ã¦5ã€œ7å€‹é¸ã¶ï¼‰**:
- å­¦ç¿’é–¢é€£: #ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ•™è‚² #ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆæ•™è‚² #èµ·æ¥­å®¶è‚²æˆ #STEAMæ•™è‚²
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: #å°å­¦ç”Ÿ #ä¸­å­¦ç”Ÿ #é«˜æ ¡ç”Ÿ #ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åˆå¿ƒè€…
- ä¿è­·è€…å‘ã‘: #ç¿’ã„äº‹ #ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç¿’ã„äº‹ #å­ã©ã‚‚ã®æ•™è‚² #å°†æ¥ã®é¸æŠè‚¢
- ç‰¹å¾´: #å€‹åˆ¥æŒ‡å° #å°‘äººæ•°åˆ¶ #AIå…ˆç”Ÿ #ãƒ¡ã‚¿ãƒãƒ¼ã‚¹å­¦ç¿’
- å ´æ‰€: #å…¨å›½å¯¾å¿œ #ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¡¾

åˆè¨ˆ8ã€œ10å€‹ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’å«ã‚ã‚‹

## æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã¨æ§‹æˆæˆ¦ç•¥ï¼ˆ${calendarDays}æ—¥åˆ†ã«å¤šæ§˜æ€§ã‚’ï¼‰

### 1. ä¿è­·è€…ã®æ‚©ã¿å…±æ„Ÿå‹ï¼ˆ20%ï¼‰
- **ãƒ•ãƒƒã‚¯**: ä¿è­·è€…ã®æ‚©ã¿ã«å…±æ„Ÿã™ã‚‹è¨€è‘‰
- **æœ¬æ–‡**: å…·ä½“çš„ãªè§£æ±ºäº‹ä¾‹ã€å®‰å¿ƒã§ãã‚‹ç’°å¢ƒã®æç¤º
- **CTA**: ç„¡æ–™ç›¸è«‡ãƒ»ä½“é¨“æˆæ¥­ã¸ã®èª˜å°
- **ãƒ†ãƒ¼ãƒä¾‹**: ã€Œå­¦æ ¡ä»¥å¤–ã®å±…å ´æ‰€ã€ã€Œå­ã©ã‚‚ã®å¯èƒ½æ€§ã€ã€Œå€‹åˆ¥ã‚µãƒãƒ¼ãƒˆã€

### 2. ç”Ÿå¾’ã®å¤‰åŒ–ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å‹ï¼ˆ20%ï¼‰
- **ãƒ•ãƒƒã‚¯**: ã€Œã€‡ã€‡ã ã£ãŸå­ãŒä»Šã§ã¯ã€œã€
- **æœ¬æ–‡**: å…·ä½“çš„ãªãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼ã€æˆé•·ã®éç¨‹
- **CTA**: ã€Œã‚ãªãŸã®ãŠå­ã•ã‚“ã‚‚ã€ã¨ã„ã†å¸Œæœ›æç¤º
- **ãƒ†ãƒ¼ãƒä¾‹**: æˆåŠŸäº‹ä¾‹ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œæˆã€è‡ªä¿¡ã®ç²å¾—

### 3. æƒ…å ±æä¾›ãƒ»æ•™è‚²å‹ï¼ˆ15%ï¼‰
- **ãƒ•ãƒƒã‚¯**: ã€ŒçŸ¥ã£ã¦ã¾ã—ãŸã‹ï¼Ÿã€ã€Œå®Ÿã¯ã€œã€
- **æœ¬æ–‡**: ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€AIã€èµ·æ¥­ã«é–¢ã™ã‚‹æœ‰ç›Šæƒ…å ±
- **CTA**: ã‚‚ã£ã¨å­¦ã³ãŸã„æ–¹ã¯ä½“é¨“æˆæ¥­ã¸
- **ãƒ†ãƒ¼ãƒä¾‹**: å­¦ç¿’Tipsã€æ¥­ç•Œãƒˆãƒ¬ãƒ³ãƒ‰ã€è±†çŸ¥è­˜ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤

### 4. å®Ÿç¸¾ãƒ»ä¿¡é ¼æ§‹ç¯‰å‹ï¼ˆ15%ï¼‰
- **ãƒ•ãƒƒã‚¯**: å…·ä½“çš„ãªæ•°å­—ã‚„å®Ÿç¸¾
- **æœ¬æ–‡**: ç”Ÿå¾’ã®ä½œå“ã€ã‚³ãƒ³ãƒ†ã‚¹ãƒˆå…¥è³ã€ç¶™ç¶šç‡ãªã©
- **CTA**: ä¸€ç·’ã«æˆé•·ã—ã¾ã›ã‚“ã‹
- **ãƒ†ãƒ¼ãƒä¾‹**: ç”Ÿå¾’ä½œå“ç´¹ä»‹ã€å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã€å—è³æ­´

### 5. è¬›å¸«ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼ç´¹ä»‹å‹ï¼ˆ10%ï¼‰
- **ãƒ•ãƒƒã‚¯**: ã€Œã“ã‚“ãªå…ˆç”ŸãŒã„ã¾ã™ã€
- **æœ¬æ–‡**: è¬›å¸«ã®å°‚é–€æ€§ã€äººæŸ„ã€ã‚µãƒãƒ¼ãƒˆä½“åˆ¶
- **CTA**: ã“ã®å…ˆç”Ÿã«ä¼šã£ã¦ã¿ã¾ã›ã‚“ã‹
- **ãƒ†ãƒ¼ãƒä¾‹**: å¡¾é•·ã€CTOã€å¡¾é ­ã€å„ãƒ¡ãƒ³ã‚¿ãƒ¼ã®ç´¹ä»‹

### 6. Q&Aãƒ»ä¸å®‰è§£æ¶ˆå‹ï¼ˆ10%ï¼‰
- **ãƒ•ãƒƒã‚¯**: ã€Œã‚ˆãã‚ã‚‹è³ªå•ã€
- **æœ¬æ–‡**: å…·ä½“çš„ãªç–‘å•ã¸ã®å›ç­”
- **CTA**: ä»–ã«è³ªå•ãŒã‚ã‚Œã°DMã¸
- **ãƒ†ãƒ¼ãƒä¾‹**: æ–™é‡‘ã€æ™‚é–“ã€ã‚µãƒãƒ¼ãƒˆä½“åˆ¶ã€å­¦ç¿’å†…å®¹

### 7. æ—¥å¸¸é¢¨æ™¯ãƒ»è¦ªè¿‘æ„Ÿå‹ï¼ˆ10%ï¼‰
- **ãƒ•ãƒƒã‚¯**: ã€Œä»Šæ—¥ã®æ•™å®¤ã§ã¯ã€
- **æœ¬æ–‡**: ãƒªã‚¢ãƒ«ãªæˆæ¥­é¢¨æ™¯ã€ç”Ÿå¾’ã®æ§˜å­
- **CTA**: ã‚ãªãŸã‚‚ä½“é¨“ã—ã¦ã¿ã¾ã›ã‚“ã‹
- **ãƒ†ãƒ¼ãƒä¾‹**: æˆæ¥­é¢¨æ™¯ã€ç”Ÿå¾’ã®å–ã‚Šçµ„ã¿ã€æ—¥å¸¸ã®ä¸€ã‚³ãƒ

**é‡è¦**: ${calendarDays}æ—¥åˆ†ã®æŠ•ç¨¿ã§ã€ä¸Šè¨˜ã®æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ã‚’ãƒãƒ©ãƒ³ã‚¹è‰¯ãé…åˆ†ã™ã‚‹ã“ã¨

## é‡è¦ãªåˆ¶ç´„
- **1æ—¥=1è¡Œ**ï¼ˆå¿…ãš13åˆ—ã‚’1è¡Œã«ã¾ã¨ã‚ã‚‹ï¼‰
- **å„æ—¥ã®è¡Œã®æœ€å¾Œã«ã¯å¿…ãšæ”¹è¡Œã‚’å…¥ã‚Œã‚‹**ï¼ˆ${calendarDays}æ—¥åˆ†=${calendarDays}è¡Œã«ã™ã‚‹ï¼‰
- ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ä¸è¦ã€ãƒ‡ãƒ¼ã‚¿è¡Œã®ã¿${calendarDays}è¡Œå‡ºåŠ›
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚«ãƒ³ãƒãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€
- **ç”»åƒèª¬æ˜ã¯å¿…ãšæ—¥æœ¬èª**
- **ãƒ†ã‚­ã‚¹ãƒˆå†…ã®æ”¹è¡Œã¯å¿…ãšã€Œ\\nã€ã§è¡¨ç¾**
- **å…¨ã¦ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã¨å…¨ã¦ã®ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨**
- **${calendarDays}æ—¥åˆ†ã§ã€å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨å…¨ãƒ«ãƒ¼ãƒ«ãŒãƒãƒ©ãƒ³ã‚¹è‰¯ãç™»å ´ã™ã‚‹ã‚ˆã†ã«é…åˆ†ã™ã‚‹**
- **æ¶ç©ºã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯çµ¶å¯¾ã«ä½œæˆã—ãªã„ã“ã¨ã€‚å¿…ãšä¸Šè¨˜ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠã™ã‚‹ã“ã¨**
- **èª‡å¼µè¡¨ç¾ã‚’é¿ã‘ã‚‹ã“ã¨**: ã€Œå¤©æ‰ã€ã€Œæœ€å¼·ã€ã€Œå®Œç’§ã€ã€Œçµ¶å¯¾ã€ãªã©ã®éåº¦ãªè¡¨ç¾ã¯ä½¿ç”¨ã—ãªã„ã€‚è½ã¡ç€ã„ãŸã€ä¿¡é ¼ã§ãã‚‹ãƒˆãƒ¼ãƒ³ã‚’ä¿ã¤

## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
ä»¥ä¸‹ã®ã‚ˆã†ã«ã€**å¿…ãšå„æ—¥ã®è¡Œã®å¾Œã«æ”¹è¡Œã‚’å…¥ã‚Œã¦ã€${calendarDays}è¡Œã§å‡ºåŠ›ã—ã¦ãã ã•ã„**:

1æ—¥ç›®ã®13åˆ—ãƒ‡ãƒ¼ã‚¿
2æ—¥ç›®ã®13åˆ—ãƒ‡ãƒ¼ã‚¿
3æ—¥ç›®ã®13åˆ—ãƒ‡ãƒ¼ã‚¿
${calendarDays > 3 ? '...ï¼ˆä¸­ç•¥ï¼‰...\n' + calendarDays + 'æ—¥ç›®ã®13åˆ—ãƒ‡ãƒ¼ã‚¿' : ''}

## å‡ºåŠ›ä¾‹ï¼ˆ3æ—¥åˆ†ï¼‰

ã€æŠ•ç¨¿1: ä¿è­·è€…ã®æ‚©ã¿å…±æ„Ÿå‹ã€‘
"æ˜ã‚‹ãåºƒã€…ã¨ã—ãŸæ•™å®¤ã§ã€å¡¾é•·å±±ï¨‘ç¢å·±ãŒè¦ªã—ã¿ã‚„ã™ã„ç¬‘é¡”ã§ç”Ÿå¾’ãŸã¡ã‚’è¦‹å®ˆã£ã¦ã„ã‚‹ã€‚ç´ºã®ãƒãƒ­ã‚·ãƒ£ãƒ„å§¿ã€‚æ•°äººã®å°ä¸­å­¦ç”ŸãŒå„ã€…ã®PCã§ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã‚’æ¥½ã—ãã†ã«ãƒ—ãƒ¬ã‚¤ã—ã¦ã„ã‚‹ã€‚å¤§å‹ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¯AIå…ˆç”Ÿã®ç”»é¢ã€‚è‡ªç„¶å…‰ãŒå·®ã—è¾¼ã‚€æ¸©ã‹ã„é›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","å­ã©ã‚‚ã®\\nå¯èƒ½æ€§","å­¦æ ¡ã ã‘ãŒ\\nå…¨ã¦ã˜ã‚ƒãªã„\\næ–°ã—ã„å­¦ã³ã®\\nå½¢","æ˜ã‚‹ã„æ•™å®¤ã§ã€ä¸€äººã®å°å­¦ç”ŸãŒPCã§ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ã‚‹ã€‚æ¨ªã§å¡¾é•·å±±ï¨‘ç¢å·±ãŒå„ªã—ãè¦‹å®ˆã‚Šã€æ™‚æŠ˜ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’é€ã£ã¦ã„ã‚‹ã€‚ç”Ÿå¾’ã®è¡¨æƒ…ã¯çœŸå‰£ã§ã€é›†ä¸­ã—ã¦ã„ã‚‹ã€‚è‡ªç„¶å…‰ãŒå·®ã—è¾¼ã‚€ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","è‡ªåˆ†ã®\\nãƒšãƒ¼ã‚¹","ç„¡ç†ãªãç¶šã\\nå€‹åˆ¥ã‚µãƒãƒ¼ãƒˆ\\nãŒã“ã“ã«","æ•°äººã®ç”Ÿå¾’ãŒã‚°ãƒ«ãƒ¼ãƒ—ã§ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è¦‹ãªãŒã‚‰æ¥½ã—ãã†ã«è©±ã—åˆã£ã¦ã„ã‚‹ã€‚å¡¾é ­é«˜å´ç¿”å¤ªãŒå„ªã—ã„ç¬‘é¡”ã§è¦‹å®ˆã£ã¦ã„ã‚‹ã€‚ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ã«ã¯ã€Œä»Šæ—¥ã®ç›®æ¨™ã€ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚æ¸©ã‹ã„é›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","å®‰å¿ƒ\\nã§ãã‚‹","ä¸€äººã˜ã‚ƒãªã„\\nä»²é–“ã¨ä¸€ç·’ã«\\næˆé•·ã™ã‚‹","ç¬‘é¡”ã®å¡¾é•·å±±ï¨‘ç¢å·±ã¨CTOäº•ä¸Šé™½æ–—ãŒä¸¦ã‚“ã§ç«‹ã£ã¦ã„ã‚‹ã€‚ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¯ã€Œç„¡æ–™ä½“é¨“å—ä»˜ä¸­ã€ã®æ–‡å­—ã¨if(å¡¾)ã®ãƒ­ã‚´ã€‚æ•°äººã®ç”Ÿå¾’ãŒæœŸå¾…ã«æº€ã¡ãŸè¡¨æƒ…ã§ç”»é¢ã‚’è¦‹ã¦ã„ã‚‹ã€‚å¸Œæœ›ã«æº€ã¡ãŸé›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","ã¾ãšã¯\\nä½“é¨“","ç„¡æ–™ä½“é¨“ã§\\nãŠå­ã•ã‚“ã®\\nç¬‘é¡”ã‚’\\nè¦‹ã¤ã‘ã‚ˆã†","ã€Œã†ã¡ã®å­ã€å­¦æ ¡ã¯è‹¦æ‰‹ã ã‘ã©â€¦ã€ãã‚“ãªä¿è­·è€…ã®æ–¹ã¸ã€‚if(å¡¾)ã§ã¯âœ…è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§å­¦ã¹ã‚‹ âœ…å¾—æ„ã‚’ä¼¸ã°ã›ã‚‹ âœ…å°†æ¥ã®é¸æŠè‚¢ãŒåºƒãŒã‚‹ã€ãã‚“ãªç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚„AIã‚’é€šã˜ã¦ã€ãŠå­ã•ã‚“ã®æ–°ã—ã„å¯èƒ½æ€§ã‚’ä¸€ç·’ã«è¦‹ã¤ã‘ã¾ã›ã‚“ã‹ï¼Ÿç„¡æ–™ä½“é¨“å®Ÿæ–½ä¸­ã§ã™ã€‚ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã¾ãŸã¯DMã¸ã€‚ #ifå¡¾ #ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° #AIå­¦ç¿’ #å­ã©ã‚‚ã®æ•™è‚² #ç¿’ã„äº‹ #å€‹åˆ¥æŒ‡å° #ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆæ•™è‚² #å°†æ¥ã®é¸æŠè‚¢"

ã€æŠ•ç¨¿2: ç”Ÿå¾’ã®å¤‰åŒ–ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å‹ã€‘
"æ˜ã‚‹ã„æ•™å®¤ã§ã€ä¸­å­¦ç”Ÿã®ç”·å­ç”Ÿå¾’ãŒPCã®å‰ã§è‡ªä¿¡ã«æº€ã¡ãŸç¬‘é¡”ã‚’è¦‹ã›ã¦ã„ã‚‹ã€‚ç”»é¢ã«ã¯è‡ªåˆ†ã§ä½œæˆã—ãŸãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ã‚‹æ§˜å­ã€‚å¡¾é•·å±±ï¨‘ç¢å·±ãŒæ¨ªã§ä¸€ç·’ã«å–œã‚“ã§ã„ã‚‹ã€‚é”æˆæ„Ÿã«æº€ã¡ãŸé›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","å¤‰åŒ–ã®\\nç‰©èª","ã‚²ãƒ¼ãƒ å¥½ããŒ\\nãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼\\nã‚’ç›®æŒ‡ã™ã¾ã§","æ•°ãƒ¶æœˆå‰ã®æ§˜å­ï¼šç”Ÿå¾’ãŒåˆã‚ã¦PCã«è§¦ã‚Œã€æˆ¸æƒ‘ã£ã¦ã„ã‚‹è¡¨æƒ…ã€‚å¡¾é ­é«˜å´ç¿”å¤ªãŒå„ªã—ãåŸºæœ¬æ“ä½œã‚’æ•™ãˆã¦ã„ã‚‹ã€‚åˆã€…ã—ã„é›°å›²æ°—ã€‚æ˜ã‚‹ã„æ•™å®¤ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","å§‹ã¾ã‚Š\\nã¯å°ã•ã","æœ€åˆã¯\\nãƒã‚¦ã‚¹æ“ä½œ\\nã‹ã‚‰\\nã‚¹ã‚¿ãƒ¼ãƒˆ","ç¾åœ¨ã®æ§˜å­ï¼šåŒã˜ç”Ÿå¾’ãŒè¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ã‚’è‡ªåˆ†ã§æ›¸ã„ã¦ã„ã‚‹ã€‚CTOäº•ä¸Šé™½æ–—ãŒæ„Ÿå¿ƒã—ãŸè¡¨æƒ…ã§è¦‹å®ˆã£ã¦ã„ã‚‹ã€‚ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¯é«˜åº¦ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã€‚æˆé•·ã‚’æ„Ÿã˜ã•ã›ã‚‹ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","ä»Šã§ã¯\\nã“ã‚“ãªã«","è‡ªåˆ†ã§è€ƒãˆ\\nè‡ªåˆ†ã§å‰µã‚‹\\nåŠ›ãŒã¤ã„ãŸ","ç”Ÿå¾’ãŒè‡ªåˆ†ã®ä½œå“ã‚’å‹é”ã«è¦‹ã›ã¦èª¬æ˜ã—ã¦ã„ã‚‹æ§˜å­ã€‚èã„ã¦ã„ã‚‹å‹é”ã‚‚èˆˆå‘³æ´¥ã€…ã€‚èƒŒæ™¯ã«ã¯å®Œæˆã—ãŸä½œå“ãŒå¤§ããè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã€‚èª‡ã‚‰ã—ã’ãªè¡¨æƒ…ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","æ¬¡ã®\\nç›®æ¨™ã¸","ã‚‚ã£ã¨å­¦ã³ãŸã„\\nã‚‚ã£ã¨å‰µã‚ŠãŸã„\\nãã®æ°—æŒã¡ãŒ\\nåŸå‹•åŠ›","ã€Œã‚²ãƒ¼ãƒ ã°ã‹ã‚Šã—ã¦ã„ãŸä¸­1ç”·å­ãŒã€åŠå¹´ã§ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã¾ã§ã«æˆé•·ã—ã¾ã—ãŸã€å®Ÿéš›ã®ä¿è­·è€…æ§˜ã®å£°ã§ã™ã€‚if(å¡¾)ã§ã¯ã€ãŠå­ã•ã‚“ã®ã€Œå¥½ãã€ã‚’å­¦ã³ã«å¤‰ãˆã‚‹ã‚µãƒãƒ¼ãƒˆã‚’ã—ã¦ã„ã¾ã™ã€‚âœ…ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã‚‹ âœ…AIå…ˆç”ŸãŒ24æ™‚é–“ã‚µãƒãƒ¼ãƒˆ âœ…å®Ÿè·µçš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½“é¨“ã€‚æ¬¡ã¯ã‚ãªãŸã®ãŠå­ã•ã‚“ã®ç•ªã§ã™ã€‚ç„¡æ–™ä½“é¨“ã§å¯èƒ½æ€§ã‚’ç™ºè¦‹ã—ã¾ã›ã‚“ã‹ï¼Ÿ #ifå¡¾ #ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° #AIå­¦ç¿’ #æˆé•·è¨˜éŒ² #ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ•™è‚² #å°å­¦ç”Ÿ #ä¸­å­¦ç”Ÿ #èµ·æ¥­å®¶è‚²æˆ"

ã€æŠ•ç¨¿3: è¬›å¸«ç´¹ä»‹å‹ã€‘
"æ˜ã‚‹ã„æ•™å®¤ã§ã€å¡¾é•·å±±ï¨‘ç¢å·±ãŒç¬‘é¡”ã§ç«‹ã£ã¦ã„ã‚‹ã€‚ç´ºã®ãƒãƒ­ã‚·ãƒ£ãƒ„å§¿ã§ã€æ‰‹ã«ã¯ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€‚èƒŒæ™¯ã«ã¯ã€Œæœªæ¥ã‚’å‰µã‚‹ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ¼ãƒ‰ã€‚æ¸©ã‹ãè¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ã€‚è‡ªç„¶å…‰ãŒå·®ã—è¾¼ã‚€ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","å¡¾é•·\\nç´¹ä»‹","if(å¡¾)ãŒ\\nç›®æŒ‡ã™\\næ–°ã—ã„æ•™è‚²ã®\\nå½¢","CTOäº•ä¸Šé™½æ–—ãŒPCã®å‰ã«åº§ã‚Šã€è¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ã‚‹æ§˜å­ã€‚é›†ä¸­ã—ãŸè¡¨æƒ…ã ãŒã€æ™‚æŠ˜ç¬‘é¡”ã‚’è¦‹ã›ã‚‹ã€‚èƒŒæ™¯ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¯ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆã¨AIã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆç”»é¢ã€‚çŸ¥çš„ã§æ´»æ°—ã‚ã‚‹é›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","æŠ€è¡“ã®\\nCTO","é–‹ç™ºåŠ›ãŒ\\nå­¦ç¿’ç’°å¢ƒã‚’\\né€²åŒ–ã•ã›ã‚‹","å¡¾é ­é«˜å´ç¿”å¤ªãŒç”Ÿå¾’ã¨1å¯¾1ã§å‘ãåˆã„ã€å„ªã—ãè©±ã‚’èã„ã¦ã„ã‚‹æ§˜å­ã€‚ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ã¦å€‹åˆ¥ã‚µãƒãƒ¼ãƒˆã‚’ã—ã¦ã„ã‚‹ã€‚ç”Ÿå¾’ã¯å®‰å¿ƒã—ãŸè¡¨æƒ…ã€‚æ¸©ã‹ãè½ã¡ç€ã„ãŸé›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","å¿ƒã®\\nã‚µãƒãƒ¼ãƒˆ","è‡¨åºŠå¿ƒç†å£«\\nçµŒé¨“ãŒæ´»ãã‚‹\\nå€‹åˆ¥æ”¯æ´","å¡¾é•·ã€CTOã€å¡¾é ­ã®3äººãŒç¬‘é¡”ã§ä¸¦ã‚“ã§ç«‹ã£ã¦ã„ã‚‹ã€‚èƒŒæ™¯ã«ã¯if(å¡¾)ã®ãƒ­ã‚´ã€‚ãã‚Œãã‚Œã®å€‹æ€§ãŒå…‰ã‚‹ã€‚ãƒãƒ¼ãƒ ã¨ã—ã¦ã®ä¸€ä½“æ„Ÿã€‚æ˜ã‚‹ãå¸Œæœ›ã«æº€ã¡ãŸé›°å›²æ°—ã€‚ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«1é©ç”¨ã€‚","ãƒ—ãƒ­ã®\\nãƒãƒ¼ãƒ ","3äººã®å°‚é–€å®¶ãŒ\\nã‚ãªãŸã‚’\\nå…¨åŠ›ã§\\nã‚µãƒãƒ¼ãƒˆ","if(å¡¾)ã®è¬›å¸«é™£ã¯ã€ãã‚Œãã‚ŒãŒç•°ãªã‚‹å°‚é–€æ€§ã‚’æŒã¤ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã€‚å¡¾é•·ï¼ˆæ•™è‚²ã¨èµ·æ¥­ï¼‰ã€CTOï¼ˆAIãƒ»ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºï¼‰ã€å¡¾é ­ï¼ˆå¿ƒç†ã‚µãƒãƒ¼ãƒˆï¼‰ã€‚å¤šè§’çš„ãªè¦–ç‚¹ã‹ã‚‰ã€ã‚ãªãŸã®ã€Œå¥½ãã€ã‚’å¿œæ´ã—ã¾ã™ã€‚âœ…æŠ€è¡“åŠ› âœ…ãƒ“ã‚¸ãƒã‚¹æ€è€ƒ âœ…å¿ƒã®ã‚±ã‚¢ã€å…¨ã¦ãŒæƒã£ãŸç’°å¢ƒã§å­¦ã³ã¾ã›ã‚“ã‹ï¼Ÿç„¡æ–™ä½“é¨“ã§ã“ã®è¬›å¸«é™£ã«ä¼šã£ã¦ã¿ã¦ãã ã•ã„ã€‚ #ifå¡¾ #ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° #AIå­¦ç¿’ #è¬›å¸«ç´¹ä»‹ #ãƒ¡ãƒ³ã‚¿ãƒ¼ #ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ•™è‚² #å€‹åˆ¥æŒ‡å° #èµ·æ¥­å®¶è‚²æˆ"

**ä¸Šè¨˜ã®ã‚ˆã†ã«ã€å¿…ãš${calendarDays}æ—¥åˆ†ã€${calendarDays}è¡Œã®CSVã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚å„è¡Œã®æœ€å¾Œã«ã¯æ”¹è¡Œã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚**
`;

    console.log('ğŸ¤– Gemini AIã§ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆä¸­...');
    console.log('â³ å‡¦ç†ã«ã¯1ã€œ2åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™\n');

    const result = await model.generateContent(prompt);
    const response = await result.response;
    let calendarCSV = response.text().trim();

    // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å‰Šé™¤
    calendarCSV = calendarCSV.replace(/```csv\n/g, '').replace(/```\n/g, '').replace(/```/g, '');

    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç”Ÿæˆ
    const now = new Date();
    const timestamp = now.toISOString().replace(/T/, '_').replace(/:/g, '-').split('.')[0];

    // calendarãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜
    const calendarDir = join(__dirname, '..', 'calendar');
    if (!existsSync(calendarDir)) {
      mkdirSync(calendarDir, { recursive: true });
      console.log('ğŸ“ calendarãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã—ãŸ');
    }
    const calendarPath = join(calendarDir, `calendar_${timestamp}.csv`);
    writeFileSync(calendarPath, calendarCSV, 'utf-8');

    // ä¿å­˜ç¢ºèª
    if (existsSync(calendarPath)) {
      console.log(`âœ… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å±¥æ­´ã«ä¿å­˜ã—ã¾ã—ãŸ: ${calendarPath}`);
    } else {
      console.warn(`âš ï¸  è­¦å‘Š: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å±¥æ­´ã¸ã®ä¿å­˜ã«å¤±æ•—ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™`);
    }

    // outputãƒ•ã‚©ãƒ«ãƒ€ã«ã‚‚ä¿å­˜ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
    const csvPath = join(__dirname, '..', 'output', 'calendar.csv');
    writeFileSync(csvPath, calendarCSV, 'utf-8');

    console.log('âœ… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼CSVã‚’ç”Ÿæˆã—ã¾ã—ãŸ');
    console.log(`ğŸ’¾ ä¿å­˜å…ˆï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰: ${calendarPath}`);
    console.log(`ğŸ’¾ ä¿å­˜å…ˆï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰: ${csvPath}\n`);

    // CSVã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦æ¤œè¨¼
    const lines = calendarCSV.split('\n').filter(line => line.trim());
    console.log(`ğŸ“Š ç”Ÿæˆã•ã‚ŒãŸæŠ•ç¨¿æ•°: ${lines.length}æ—¥åˆ†\n`);

    // ã‚µãƒ³ãƒ—ãƒ«ã‚’è¡¨ç¤º
    if (lines.length > 0) {
      console.log('ğŸ“ æœ€åˆã®æŠ•ç¨¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:');
      const firstLine = parseCSVLine(lines[0]);
      console.log(`  åˆ—æ•°: ${firstLine.length}åˆ—`);
      console.log('  è¡¨ç´™ç”»åƒ: ', firstLine[0]?.substring(0, 60) + '...');
      console.log('  è¡¨ç´™ãƒ†ã‚­ã‚¹ãƒˆ1: ', firstLine[1]);
      console.log('  è¡¨ç´™ãƒ†ã‚­ã‚¹ãƒˆ2: ', firstLine[2]);
      console.log('  æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆ: ', firstLine[12]?.substring(0, 80) + '...');
    }

    return csvPath;
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error.message);
    process.exit(1);
  }
}

/**
 * CSVè¡Œã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆã‚¯ã‚©ãƒ¼ãƒˆå¯¾å¿œï¼‰
 */
function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;

  for (let i = 0; i < line.length; i++) {
    const char = line[i];
    const nextChar = line[i + 1];

    if (char === '"') {
      if (inQuotes && nextChar === '"') {
        current += '"';
        i++;
      } else {
        inQuotes = !inQuotes;
      }
    } else if (char === ',' && !inQuotes) {
      result.push(current);
      current = '';
    } else {
      current += char;
    }
  }

  result.push(current);
  return result;
}

// ãƒ¡ã‚¤ãƒ³å‡¦ç†
generateCalendar();
